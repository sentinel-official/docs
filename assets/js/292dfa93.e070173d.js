"use strict";(self.webpackChunksentinel_docs=self.webpackChunksentinel_docs||[]).push([[2561],{18760:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"missed-blocks-checker","title":"Missed Blocks Checker","description":"The Missed Blocks Checker tool monitors all validators to track missed blocks and reports them to your chosen contacts. It also keeps you updated on other validator activities, such as tombstone events, jailing, and unjailing.","source":"@site/docs/node-monitoring/missed-blocks-checker.md","sourceDirName":".","slug":"/missed-blocks-checker","permalink":"/node-monitoring/missed-blocks-checker","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Missed Blocks Checker","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Grafana","permalink":"/node-monitoring/grafana"},"next":{"title":"Uptime Kuma","permalink":"/node-monitoring/uptime-kuma"}}');var o=n(74848),a=n(28453);const r={title:"Missed Blocks Checker",sidebar_position:5},i="Missed Blocks Checker",l={},c=[{value:"PostgreSQL as Requirement",id:"postgresql-as-requirement",level:2},{value:"Install PostgreSQL",id:"install-postgresql",level:3},{value:"Start and Enable PostgreSQL Service",id:"start-and-enable-postgresql-service",level:3},{value:"Secure PostgreSQL",id:"secure-postgresql",level:3},{value:"Add Postgres user to ADM group",id:"add-postgres-user-to-adm-group",level:3},{value:"Create a Database and Test the Connection",id:"create-a-database-and-test-the-connection",level:3},{value:"Download &amp; Installation",id:"download--installation",level:2},{value:"Create a Telegram Bot",id:"create-a-telegram-bot",level:3},{value:"Create a Config file",id:"create-a-config-file",level:3},{value:"Add a system unit file",id:"add-a-system-unit-file",level:3},{value:"Start Missed Blocks Checker service",id:"start-missed-blocks-checker-service",level:3},{value:"Verify the Setup",id:"verify-the-setup",level:3},{value:"Usage",id:"usage",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{Details:t}=s;return t||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"missed-blocks-checker",children:"Missed Blocks Checker"})}),"\n",(0,o.jsx)(s.p,{children:"The Missed Blocks Checker tool monitors all validators to track missed blocks and reports them to your chosen contacts. It also keeps you updated on other validator activities, such as tombstone events, jailing, and unjailing."}),"\n",(0,o.jsx)(s.h2,{id:"postgresql-as-requirement",children:"PostgreSQL as Requirement"}),"\n",(0,o.jsx)(s.p,{children:"For the best experience with Missed Blocks Checker, it's recommended to install PostgreSQL. It's a robust, service-based database that's well-suited for production environments."}),"\n",(0,o.jsx)(s.h3,{id:"install-postgresql",children:"Install PostgreSQL"}),"\n",(0,o.jsx)(s.p,{children:"To install PostgreSQL along with additional utilities provided by the postgresql-contrib package, run the following command:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo apt update\nsudo apt install postgresql postgresql-contrib\n"})}),"\n",(0,o.jsx)(s.h3,{id:"start-and-enable-postgresql-service",children:"Start and Enable PostgreSQL Service"}),"\n",(0,o.jsx)(s.p,{children:"After installation, the PostgreSQL service usually starts automatically. To check its status, use:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo systemctl status postgresql\n"})}),"\n",(0,o.jsx)(s.p,{children:"If the service is not running, you can start it with:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo systemctl start postgresql\n"})}),"\n",(0,o.jsx)(s.p,{children:"To ensure PostgreSQL starts automatically on system boot, run:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo systemctl enable postgresql\n"})}),"\n",(0,o.jsx)(s.h3,{id:"secure-postgresql",children:"Secure PostgreSQL"}),"\n",(0,o.jsxs)(s.p,{children:["By default, PostgreSQL creates a user named ",(0,o.jsx)(s.code,{children:"postgres"})," with full administrative privileges. For security, it's recommended to set a password for this user. Follow these steps:"]}),"\n",(0,o.jsx)(s.p,{children:"Switch to the postgres user:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo -i -u postgres\n"})}),"\n",(0,o.jsx)(s.p,{children:"Access the PostgreSQL prompt:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"psql\n"})}),"\n",(0,o.jsxs)(s.p,{children:["Set a password for the ",(0,o.jsx)(s.code,{children:"postgres"})," user:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"\\password postgres\n"})}),"\n",(0,o.jsx)(s.p,{children:"Exit the PostgreSQL prompt by typing:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"\\q\n"})}),"\n",(0,o.jsx)(s.h3,{id:"add-postgres-user-to-adm-group",children:"Add Postgres user to ADM group"}),"\n",(0,o.jsxs)(s.p,{children:["Add the ",(0,o.jsx)(s.code,{children:"postgres"})," user to the ",(0,o.jsx)(s.code,{children:"adm"})," group"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo usermod -a -G adm postgres\n"})}),"\n",(0,o.jsxs)(s.p,{children:["Grant execute permission for ",(0,o.jsx)(s.code,{children:"other"})," on /home/sentinel This allows users other than ",(0,o.jsx)(s.code,{children:"sentinel"})," to traverse the directory."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo chmod o+x /home/sentinel\n"})}),"\n",(0,o.jsx)(s.p,{children:"Test Access for postgres user if it can access the binary:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo -u postgres /home/sentinel/missed-blocks-checker/missed-blocks-checker --version\n"})}),"\n",(0,o.jsx)(s.h3,{id:"create-a-database-and-test-the-connection",children:"Create a Database and Test the Connection"}),"\n",(0,o.jsxs)(s.p,{children:["Now that the ",(0,o.jsx)(s.code,{children:"postgres"})," user is secured, you can create a new database:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"CREATE DATABASE missed_db;\n"})}),"\n",(0,o.jsx)(s.p,{children:"Exit the PostgreSQL prompt:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"\\q\n"})}),"\n",(0,o.jsx)(s.p,{children:"Test the connection to your new database:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"psql -d missed_db -U postgres\n"})}),"\n",(0,o.jsx)(s.p,{children:"If the connection is successful, you're now connected to your new database using the postgres user."}),"\n",(0,o.jsx)(s.h2,{id:"download--installation",children:"Download & Installation"}),"\n",(0,o.jsxs)(s.p,{children:["Now that PostgreSQL is installed, clone the Missed Blocks Checker ",(0,o.jsx)(s.a,{href:"https://github.com/QuokkaStake/missed-blocks-checker",children:"repository"})," on your validator and compile the binary. Make sure you have Go installed before proceeding."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"git clone https://github.com/QuokkaStake/missed-blocks-checker\ncd missed-blocks-checker\nmake build\n"})}),"\n",(0,o.jsxs)(s.p,{children:["Add a symbolic link to the ",(0,o.jsx)(s.code,{children:"/usr/local/bin/"})," directory for system-wide access to Missed BLocks Checker:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo ln -s /home/${USER}/missed-blocks-checker/missed-blocks-checker /usr/local/bin/\n"})}),"\n",(0,o.jsx)(s.h3,{id:"create-a-telegram-bot",children:"Create a Telegram Bot"}),"\n",(0,o.jsxs)(s.p,{children:["To use the Missed Blocks Checker on Telegram, you first need to create a bot. You can do this using Telegram\u2019s ",(0,o.jsx)(s.a,{href:"https://t.me/BotFather",children:"BotFather"}),". For example, you could create a bot named ",(0,o.jsx)(s.code,{children:"@my_validator_missed_blocks"}),"."]}),"\n",(0,o.jsx)(s.p,{children:"Once the bot is created, make sure to save the following details:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Token"}),": This is a unique identifier tied to your bot\u2019s name"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Chat ID"}),": To get your chat ID, use the ",(0,o.jsx)(s.a,{href:"https://t.me/chatIDrobot",children:"chatIDrobot"})," bot"]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"You\u2019ll need both the Token and Chat ID to set them up in the config.toml file in the next step."}),"\n",(0,o.jsx)(s.h3,{id:"create-a-config-file",children:"Create a Config file"}),"\n",(0,o.jsxs)(s.p,{children:["Inside your ",(0,o.jsx)(s.code,{children:"missed-blocks-checker"})," directory create the config file:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"nano config.toml\n"})}),"\n",(0,o.jsxs)(s.p,{children:["Paste the following code in it making sure to edit the fields between ",(0,o.jsx)(s.code,{children:"<"})," and ",(0,o.jsx)(s.code,{children:">"})," characters"]}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"config.toml"}),(0,o.jsx)("p",{children:(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",metastring:'title="/home/${USER}/missed-blocks-checker/config.toml"',children:'# Log configuration\n[log]\n# Logging level. Set it to "debug" or even "trace" to see more logs, or "warn" or even "error"\n# to reduce the logs amount. Defaults to "info".\nlevel = "info"\n# If set to true, the app with display logs in JSON, which is handy if you are using\n# a logging solution like Loki or Elastic stack. Defaults to false.\njson = false\n\n# Database configuration\n[database]\n# Type of the database. Currently supported DB types are: postgres, sqlite.\ntype = "postgres"\n# Where the database will be stored.\n# If it\'s a PostgreSQL database, a connection string is expected (like postgres://user:password@host:port/database)\n# If it\'s a SQLite database, a path to the file storing a database is expected.\npath = "postgres://postgres:<your_password>>@localhost:5432/missed_db"\n\n# Prometheus metrics configuration\n[metrics]\n# Whether to enable metrics. If yes, a web server will be spawned at listen-addr,\n# and you can query metrics by fetching "<listen-addr>/metrics", or set a Prometheus\n# to scrape it. It\'s useful, and you can build alerts to see if anything is going wrong.\n# Defaults to true\nenabled = true\n# Metrics webserver listen address. Defaults to ":9570".\nlisten-addr = ":9570"\n\n# Chains configuration. You need at least 1 chain.\n[[chains]]\n# Chain codename, used in metrics.\nname = "sentinel"\n# Chain pretty name. Used in Telegram commands or other places. The app will use fallback\n# to name if it\'s not provided.\npretty-name = "Sentinel"\n# RPC endpoints. Need at least 1. Better to have many, so the app would work in case one is down.\nrpc-endpoints = [\n    "https://rpc-sentinel.busurnode.com:443",\n    "https://rpc.sentineldao.com:443",\n    "https://rpc.sentinel.quokkastake.io:443"\n]\n# Telegram reporter configuration. Needs token and chat. See README.md on how to set it up\ntelegram = { token = "<your_telegram_token>", chat = <your_telegram_chat_id> }\n# Discord reporter configuration. Needs token, server ID (aka guild) and channel ID.\n# See README.md on how to set it up.\ndiscord = { token = "xxx", guild = "12345", channel = "67890" }\n# Explorer configuration, to generate links to validators.\n# Currently supported explorers are: Mintscan and Ping.pub, but you can use\n# a custom link pattern to generate custom links.\n# This chain configuration uses Mintscan, see below for Ping.pub and custom explorers.\n# If it\'s omitted, no links will be generated and everything will be in plain text.\nexplorer = { mintscan-prefix = "sent" }\n# How much blocks to store. This should be more than blocks window, as otherwise\n# the app would never be able to generate reports as there\'s always not enough blocks\n# to calculate missed blocks counter. Optimal would be to store at least 2x blocks\n# of the blocks window. Defaults to 20000 (2x from 10k blocks window).\nstore-blocks = 20000\n# Blocks window to calculate missed blocks counter against. Defaults to 10000.\nblocks-window = 10000\n# How much blocks a validator needs to sign in any specific window. Defaults to 0.05 (5%)\nmin-signed-per-window = 0.05\n# Reporting thresholds.\n# This is an array of percent thresholds for missed blocks groups.\n# For example, if it\'s [0, 50, 100], there are 2 groups: from 0% to 50% and from 50% to 100%\n# of missed blocks. An event is going to be sent once a validator\'s missed blocks count moves\n# from one group to another.\n# Should be an array of at least 2 values (2 values mean 1 group), the first value\n# should be always 0 (as in 0%, the last value should always be 100 (as in 100%).\n# Defaults to [0, 0.5, 1, 5, 10, 25, 50, 75, 90, 100]\nthresholds = [0, 5, 10, 25, 50, 75, 100]\n# An emoji that\'s going to appear in the message when a validator **enters** this group\n# (for example, when a validator is missing blocks and its missed blocks counter moves from one group\n# to another).\n# This and emoji-end arrays\' length should be equal to the amount of missed blocks group\n# (so if you have 3 thresholds, you have 2 groups, so these arrays both should have 2 values).\n# Defaults to ["\ud83d\udfe1", "\ud83d\udfe1", "\ud83d\udfe1", "\ud83d\udfe0", "\ud83d\udfe0", "\ud83d\udfe0", "\ud83d\udd34", "\ud83d\udd34", "\ud83d\udd34"]\nemoji-start = ["\ud83d\udfe1", "\ud83d\udfe1", "\ud83d\udfe0", "\ud83d\udfe0", "\ud83d\udd34", "\ud83d\udd34"]\n# An emoji that\'s going to appear in the message when a validator **leaves** this group\n# (for example, when a validator is recovering and its missed blocks counter moves from one group\n# to another).\n# This and emoji-end arrays\' length should be equal to the amount of missed blocks group\n# (so if you have 3 thresholds, you have 2 groups, so these arrays both should have 2 values).\n# Defaults to ["\ud83d\udfe1", "\ud83d\udfe1", "\ud83d\udfe1", "\ud83d\udfe0", "\ud83d\udfe0", "\ud83d\udfe0", "\ud83d\udd34", "\ud83d\udd34", "\ud83d\udd34"]\nemoji-start = ["\ud83d\udfe1", "\ud83d\udfe1", "\ud83d\udfe0", "\ud83d\udfe0", "\ud83d\udd34", "\ud83d\udd34"]\n# An emoji that\'s going to appear in the message when a validator **leaves** this group\n# (for example, when a validator is recovering and its missed blocks counter moves from one group\n# to another).\n# Defaults to ["\ud83d\udfe2", "\ud83d\udfe1", "\ud83d\udfe1", "\ud83d\udfe1", "\ud83d\udfe1", "\ud83d\udfe0", "\ud83d\udfe0", "\ud83d\udfe0", "\ud83d\udfe0"]\nemoji-end = ["\ud83d\udfe2", "\ud83d\udfe1", "\ud83d\udfe1", "\ud83d\udfe0", "\ud83d\udfe0", "\ud83d\udfe0"]\n# Minimal interval between two snapshots to be reported.\n# For example, if a snapshot was generated at block 10, and snapshot-interval is 5,\n# then the next snapshot would be done on block 15 or later (if there were errors processing it/fetching datat).\n# Defaults to 1, so every block.\nsnapshots-interval = 10\n# Periodical intervals check params. You can omit this completely, or some fields inside and the default\n# ones will be used.\n[chains.intervals]\n# Interval to fetch blocks missed in the local state from chain.\n# Setting it to 0 would disable automatic blocks fetching, which is not desired.\n# You can set it to something smaller if your websocket connection is lagging.\n# Defaults to 30.\nblocks = 30\n# Interval to fetch slashing params from chain. Set to 0 to disable fetching slashing params from chain\n# and use local blocks-window and min-signed-per-window.\n# Defaults to 300.\nslashing-params = 300\n# Interval to fetch soft opt-out threshold from consumer chain.\n# (e.g. how much of voting power should sign blocks).\n# Set to 0 to disable and use local threshold.\n# This param is not used for sovereign chains.\n# Defaults to 300.\nsoft-opt-out-threshold = 300\n# Interval to trim local database. Set it to 0 to disable database trimming.\n# Defaults to 300.\ntrim = 300\n# Queries pagination params.You can omit this completely, or some fields inside and the default\n# ones will be used.\n[chains.pagination]\n# How many blocks to query at once.\n# Defaults to 100.\n# Decrease it if the node you\'re querying has rate limiting and doing too many requests at once\n# causes some requests to fail\nblocks-search = 100\n# How many validators to query at once.\nvalidators-list = 1000\n# How many signing infos to query at once.\nsigning-infos = 1000\n'})})})]}),"\n",(0,o.jsx)(s.h3,{id:"add-a-system-unit-file",children:"Add a system unit file"}),"\n",(0,o.jsx)(s.p,{children:"Create the .service file with a text editor"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo nano /etc/systemd/system/missed-blocks-checker.service\n"})}),"\n",(0,o.jsx)(s.p,{children:"Paste the below text"}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"missed-blocks-checker.service"}),(0,o.jsx)("p",{children:(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",metastring:'title="/etc/systemd/system/missed-blocks-checker.service"',children:"[Unit]\nDescription=Missed Blocks Checker\nAfter=network-online.target\n\n[Service]\nUser=postgres\nTimeoutStartSec=0\nCPUWeight=95\nIOWeight=95\nExecStart=missed-blocks-checker --config /home/sentinel/missed-blocks-checker/config.toml\nRestart=always\nRestartSec=2\nLimitNOFILE=800000\nKillSignal=SIGTERM\n\n[Install]\nWantedBy=multi-user.target\n"})})})]}),"\n",(0,o.jsx)(s.p,{children:"Reload the systemd Daemon"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,o.jsx)(s.p,{children:"Enable autostart of Missed Blocks Checker service"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo systemctl enable missed-blocks-checker.service\n"})}),"\n",(0,o.jsx)(s.h3,{id:"start-missed-blocks-checker-service",children:"Start Missed Blocks Checker service"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo systemctl start missed-blocks-checker.service\n"})}),"\n",(0,o.jsx)(s.p,{children:"Use this command to check logs in real time"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo journalctl -u missed-blocks-checker.service -f --output cat\n"})}),"\n",(0,o.jsx)(s.h3,{id:"verify-the-setup",children:"Verify the Setup"}),"\n",(0,o.jsx)(s.p,{children:"If everything is set up correctly, you should see the PostgreSQL database initialized and the tool up and running within a few minutes."}),"\n",(0,o.jsx)(s.h2,{id:"usage",children:"Usage"}),"\n",(0,o.jsxs)(s.p,{children:["After completing the installation, simply open your Telegram bot ",(0,o.jsx)(s.code,{children:"@my_validator_missed_blocks"}),". Click on ",(0,o.jsx)(s.code,{children:"/start"}),", and you'll see the following menu:"]}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.img,{src:n(6633).A+"",width:"411",height:"391"})}),"\n",(0,o.jsx)(s.p,{children:"That's it! You're all set to begin."})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},6633:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/missed-blocks-checker-05b6d183352700a144c5ac80bd232b4c.png"},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>i});var t=n(96540);const o={},a=t.createContext(o);function r(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);