"use strict";(self.webpackChunksentinel_docs=self.webpackChunksentinel_docs||[]).push([[8569],{96825:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"upgrade","title":"Chain Upgrade","description":"This guide outlines the steps required to upgrade your Sentinel Hub software. Follow these instructions carefully to ensure a smooth process.","source":"@site/docs/full-node-setup/upgrade.md","sourceDirName":".","slug":"/upgrade","permalink":"/full-node-setup/upgrade","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"title":"Chain Upgrade","sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"Server Migration","permalink":"/full-node-setup/validate/maintenance/server-migration"},"next":{"title":"Overview","permalink":"/full-node-setup/docker/overview"}}');var r=s(74848),t=s(28453);const l={title:"Chain Upgrade",sidebar_position:11},d="Chain Upgrade",a={},o=[{value:"Upgrade List",id:"upgrade-list",level:2},{value:"Build the Binary",id:"build-the-binary",level:2},{value:"Automatic Upgrade: Cosmovisor",id:"automatic-upgrade-cosmovisor",level:2},{value:"Consensus Breaking (Chain Upgrade)",id:"consensus-breaking-chain-upgrade",level:3},{value:"Non Consensus Breaking",id:"non-consensus-breaking",level:3},{value:"Manual Upgrade",id:"manual-upgrade",level:2},{value:"Stop the node",id:"stop-the-node",level:3},{value:"Install the new version",id:"install-the-new-version",level:3},{value:"Start the node",id:"start-the-node",level:3},{value:"In Case of Upgrade Failure",id:"in-case-of-upgrade-failure",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"chain-upgrade",children:"Chain Upgrade"})}),"\n",(0,r.jsx)(n.p,{children:"This guide outlines the steps required to upgrade your Sentinel Hub software. Follow these instructions carefully to ensure a smooth process."}),"\n",(0,r.jsx)(n.h2,{id:"upgrade-list",children:"Upgrade List"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"Upgrade #"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"Binary Version"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"Name"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"Block Height"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"Proposal #"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"Commit Hash"})})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"upgrade-1"}),(0,r.jsx)(n.td,{children:"v0.7.0"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"upgrade-1"})}),(0,r.jsx)(n.td,{children:"1,272,000"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://explorer.busurnode.com/sentinel/gov/3",children:"3"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/sentinel-official/hub/commit/600fd5f8b71f60332656b826df2e3fa3bc6c5e5e",children:"600fd5f"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"upgrade-2"}),(0,r.jsx)(n.td,{children:"v0.8.3"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"upgrade-2"})}),(0,r.jsx)(n.td,{children:"2,586,000"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://explorer.busurnode.com/sentinel/gov/5",children:"5"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/sentinel-official/hub/commit/fa7cd3c7d5f427308d8a837a18b951482ce5c9e2",children:"fa7cd3c"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"upgrade-3"}),(0,r.jsx)(n.td,{children:"v0.9.2"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"upgrade-3"})}),(0,r.jsx)(n.td,{children:"5,125,000"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://explorer.busurnode.com/sentinel/gov/9",children:"9"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/sentinel-official/hub/commit/d04a4004600c9d19e326f61a13fcef853616e3ed",children:"d04a400"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"upgrade-4"}),(0,r.jsx)(n.td,{children:"v0.10.1"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"upgrade-4"})}),(0,r.jsx)(n.td,{children:"9,348,475"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://explorer.busurnode.com/sentinel/gov/19",children:"19"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/sentinel-official/hub/commit/bbe6fab51c81863551a69aeb4977ec4c19fcd60a",children:"bbe6fab"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"upgrade-5"}),(0,r.jsx)(n.td,{children:"v0.11.2"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"v11"})}),(0,r.jsx)(n.td,{children:"12,310,005"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://explorer.busurnode.com/sentinel/gov/30",children:"30"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/sentinel-official/hub/commit/54c28ae02786b62b25303759da761e5ce1226029",children:"54c28ae"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"upgrade-6"}),(0,r.jsx)(n.td,{children:"v12.0.0"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"v12_0_0"})}),(0,r.jsx)(n.td,{children:"23,997,755"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://explorer.busurnode.com/sentinel/gov/64",children:"64"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/sentinel-official/sentinelhub/commit/eb3c5c4287674bd0a7e3180c5cec7d03196207b3",children:"eb3c5c4"})})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"build-the-binary",children:"Build the Binary"}),"\n",(0,r.jsxs)(n.p,{children:["When the upgrade is available clone the Sentinel Hub ",(0,r.jsx)(n.a,{href:"https://github.com/sentinel-official/hub",children:"repository"}),", checkout at the new version and install it"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'git clone https://github.com/sentinel-official/sentinelhub.git "${HOME}/sentinelhub"\r\ncd "${HOME}/sentinelhub"\r\ngit checkout <new_version>\r\nmake install\n'})}),"\n",(0,r.jsx)(n.h2,{id:"automatic-upgrade-cosmovisor",children:"Automatic Upgrade: Cosmovisor"}),"\n",(0,r.jsxs)(n.p,{children:["If you\u2019re using or planning to use Cosmovisor (see the ",(0,r.jsx)(n.a,{href:"/full-node-setup/validate/essential-tools/cosmovisor",children:"guide"}),"), the upgrade process will be mostly automatic. Once the new binary is built and placed in the correct directory, Cosmovisor will take care of the rest."]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"Upgrades can be either consensus-breaking or non-consensus-breaking.\r\nFollow the appropriate section below depending on the upgrade type."})}),"\n",(0,r.jsx)(n.h3,{id:"consensus-breaking-chain-upgrade",children:"Consensus Breaking (Chain Upgrade)"}),"\n",(0,r.jsxs)(n.p,{children:["Create the upgrade directory inside Cosmovisor with the name of the version (for the last upgrade was ",(0,r.jsx)(n.strong,{children:"v12_0_0"})," as you can see ",(0,r.jsx)(n.a,{href:"https://ping.pub/sentinel/gov/64",children:"here"})," under the section plan, tab name)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/.sentinelhub/cosmovisor/upgrades/<upgrade_name>/bin\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Copy ",(0,r.jsx)(n.code,{children:"sentinelhub"})," binary in it"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cp ~/go/bin/sentinelhub ~/.sentinelhub/cosmovisor/upgrades/<upgrade_name>/bin\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Check if the ",(0,r.jsx)(n.code,{children:"sentinelhub"})," binary upgrade was copied and if it is the correct version:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"~/.sentinelhub/cosmovisor/upgrades/<upgrade_name>/bin/sentinelhub version\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now that you have prepared and deployed the new binary, the remaining steps will be managed by Cosmovisor when the upgrade is scheduled to take place. Here's a breakdown of the process:"}),"\n",(0,r.jsxs)(n.p,{children:["When the designated block height is reached, the blockchain temporarily halts its operations. Following this, an ",(0,r.jsx)(n.code,{children:"upgrade-info.json"})," file is generated and put into the folder ",(0,r.jsx)(n.code,{children:".sentinelhub/cosmovisor/upgrades/<upgrade_name>/"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"The content of this file will be the following, based on the last hub upgrade:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=".sentinelhub/cosmovisor/upgrades/<upgrade_name>/"',children:'{"name":"v12_0_0","time":"0001-01-01T00:00:00Z","height":23997755}\n'})}),"\n",(0,r.jsx)(n.p,{children:"The Cosmovisor system identifies the existence of this file and triggers the required sequence of actions. These actions include pausing the node, inserting the relevant binary into the specified directory, and subsequently restarting the node."}),"\n",(0,r.jsx)(n.p,{children:"This carefully orchestrated sequence guarantees a seamless transition and successful execution of the blockchain upgrade."}),"\n",(0,r.jsx)(n.h3,{id:"non-consensus-breaking",children:"Non Consensus Breaking"}),"\n",(0,r.jsx)(n.p,{children:"For non-consensus upgrades, you only need to replace the running binary with the new one."}),"\n",(0,r.jsx)(n.p,{children:"Stop cosmovisor"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl stop cosmovisor.service\n"})}),"\n",(0,r.jsx)(n.p,{children:"Copy the newly created Sentinel Hub binary into Cosmovisor"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cp go/bin/sentinelhub .sentinelhub/cosmovisor/current/bin/\n"})}),"\n",(0,r.jsx)(n.p,{children:"Verify that the cosmovisor version is current"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cosmovisor version\n"})}),"\n",(0,r.jsx)(n.p,{children:"Start cosmovisor"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start cosmovisor\n"})}),"\n",(0,r.jsx)(n.p,{children:"Monitor the logs to confirm the successful execution of the process"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"journalctl -u cosmovisor.service -f --output=cat\n"})}),"\n",(0,r.jsx)(n.h2,{id:"manual-upgrade",children:"Manual Upgrade"}),"\n",(0,r.jsx)(n.p,{children:"If you\u2019re not using Cosmovisor, follow these manual steps once the blockchain halts at the upgrade block height."}),"\n",(0,r.jsx)(n.h3,{id:"stop-the-node",children:"Stop the node"}),"\n",(0,r.jsx)(n.p,{children:"Check the current block height to confirm it matches the upgrade height:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -fsLS http://127.0.0.1:26657/status | jq -r '.result.sync_info.latest_block_height'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then stop the Sentinel Hub service:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl stop sentinelhub.service\n"})}),"\n",(0,r.jsx)(n.h3,{id:"install-the-new-version",children:"Install the new version"}),"\n",(0,r.jsx)(n.p,{children:"Link the new binary:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# For Ubuntu installation\r\nsudo ln -s "${GOBIN}/sentinelhub" /usr/bin/sentinelhub\r\n\r\n# For manual installation\r\nsudo ln -s "${GOBIN}/sentinelhub" /usr/local/bin/sentinelhub\n'})}),"\n",(0,r.jsx)(n.h3,{id:"start-the-node",children:"Start the node"}),"\n",(0,r.jsx)(n.p,{children:"Verify the version:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sentinelhub version --long\n"})}),"\n",(0,r.jsx)(n.p,{children:"Restart the service:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start sentinelhub.service\n"})}),"\n",(0,r.jsx)(n.h3,{id:"in-case-of-upgrade-failure",children:"In Case of Upgrade Failure"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Roll back to the previous version (e.g., if ",(0,r.jsx)(n.code,{children:"upgrade-6"})," fails, use version ",(0,r.jsx)(n.code,{children:"v0.11.2"}),")."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Confirm the rollback version matches the upgrade table above."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Restart the node using the ",(0,r.jsx)(n.code,{children:"--unsafe-skip-upgrades"})," flag at the upgrade height:"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sentinelhub start --unsafe-skip-upgrades <block_height>\n"})}),"\n",(0,r.jsx)(n.p,{children:"This allows the node to continue syncing while minimizing downtime."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var i=s(96540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);