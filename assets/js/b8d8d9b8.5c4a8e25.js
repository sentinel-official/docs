"use strict";(self.webpackChunksentinel_docs=self.webpackChunksentinel_docs||[]).push([[1770],{33820:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"metrics/exporters/cosmos-validator-exporter","title":"Cosmos Validator Exporter","description":"Cosmos Validator Exporter can be used to create a dashboard for one or multiple validators, enabling you to visualize essential metrics such as the total staked amount, delegator count, and more. Additionally, you can set up alerts for various validator metrics, including their status, ranking, total staked amount, and more.","source":"@site/docs/node-monitoring/metrics/exporters/cosmos-validator-exporter.md","sourceDirName":"metrics/exporters","slug":"/metrics/exporters/cosmos-validator-exporter","permalink":"/node-monitoring/metrics/exporters/cosmos-validator-exporter","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Cosmos Validator Exporter","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Cosmos Node Exporter","permalink":"/node-monitoring/metrics/exporters/cosmos-node-exporter"},"next":{"title":"Alertmanager","permalink":"/node-monitoring/metrics/alertmanager"}}');var t=n(74848),r=n(28453);const a={title:"Cosmos Validator Exporter",sidebar_position:5},i="Cosmos Validator Exporter",l={},d=[{value:"Validator Machine",id:"validator-machine",level:2},{value:"Download &amp; Installation",id:"download--installation",level:3},{value:"Create a Config file",id:"create-a-config-file",level:3},{value:"Add a system unit file",id:"add-a-system-unit-file",level:3},{value:"Start Cosmos Validator Exporter service",id:"start-cosmos-validator-exporter-service",level:3},{value:"Open Firewall Port",id:"open-firewall-port",level:3},{value:"Monitoring Machine",id:"monitoring-machine",level:2}];function c(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components},{Details:n}=o;return n||function(e,o){throw new Error("Expected "+(o?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.header,{children:(0,t.jsx)(o.h1,{id:"cosmos-validator-exporter",children:"Cosmos Validator Exporter"})}),"\n",(0,t.jsxs)(o.p,{children:[(0,t.jsx)(o.a,{href:"https://github.com/QuokkaStake/cosmos-validators-exporter",children:"Cosmos Validator Exporter"})," can be used to create a dashboard for one or multiple validators, enabling you to visualize essential metrics such as the total staked amount, delegator count, and more. Additionally, you can set up alerts for various validator metrics, including their status, ranking, total staked amount, and more."]}),"\n",(0,t.jsx)(o.h2,{id:"validator-machine",children:"Validator Machine"}),"\n",(0,t.jsx)(o.p,{children:"Execute the following operations on your validator machine"}),"\n",(0,t.jsx)(o.h3,{id:"download--installation",children:"Download & Installation"}),"\n",(0,t.jsxs)(o.p,{children:["To get started, clone the Cosmos Validator Exporter ",(0,t.jsx)(o.a,{href:"https://github.com/QuokkaStake/cosmos-validators-exporter",children:"repository"})," on your validator and compile the binary. Make sure you have Go installed before proceeding."]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"git clone https://github.com/QuokkaStake/cosmos-validators-exporter\ncd cosmos-validators-exporter\nmake build\n"})}),"\n",(0,t.jsxs)(o.p,{children:["Add a symbolic link to the ",(0,t.jsx)(o.code,{children:"/usr/local/bin/"})," directory for system-wide access to Cosmos Validator Exporter:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"sudo ln -s /home/${USER}/cosmos-validators-exporter/cosmos-validators-exporter /usr/local/bin/\n"})}),"\n",(0,t.jsx)(o.h3,{id:"create-a-config-file",children:"Create a Config file"}),"\n",(0,t.jsxs)(o.p,{children:["Inside your ",(0,t.jsx)(o.code,{children:"cosmos-validators-exporter"})," directory create the config file:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"nano config.toml\n"})}),"\n",(0,t.jsx)(o.p,{children:"Paste the following code in it making sure to add your sentvaloper and sentvalcons addresses:"}),"\n",(0,t.jsxs)(n,{children:[(0,t.jsx)("summary",{children:"config.toml"}),(0,t.jsx)("p",{children:(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",metastring:'title="/home/${USER}/cosmos-validators-exporter/config.toml"',children:'# Global timeout for RPC queries, in seconds. Defaults to 5.\ntimeout = 10\n# The address the exporter will listen on .Defaults to ":9560".\nlisten-address = ":9560"\n\n# Logging config\n[log]\n# Log level. Change it to "debug" or even trace for more verbosity and debugging. Defaults to "info".\nlevel = "debug"\n# Whether all the logs should be written in JSON instead of a pretty-printed text. Useful if you have\n# logging solutions, like Elastic stack. Defaults to false.\njson = false\n\n# Per-chain config.\n[[chains]]\n# Chain name that will go into labels. Required.\nname = "sentinel"\n# LCD endpoint to query data from. Required.\nlcd-endpoint = "https://api.sentineldao.com"\n# Chain\'s base denom. Required.\n# This value is used to convert denoms (e.g. if you have a balance with denom=uatom,\n# a denom in config with denom=uatom and display-denom=atom, then it will be converted).\n# Also, it will be prepended as a denom to metrics like total delegations of a validator\n# and total bonded.\nbase-denom = "udvpn"\n# Denoms info.\n# Used when calculating metric for token price.\n# This is an array of objects with following values:\n# 1. coingecko-currency\n# Coingecko currency, specify it if you want to also get the wallet balance\n# in total in USD as a standalone metric. Optional.\n# 2. denom\n# The actual denom value (such as "uatom" for Cosmos Hub or "ibc/xxxxx" for IBC denoms). Required.\n# 3. display-denom\n# The denom that\'ll be returned in labels. Required.\n# 4. denom-exponent\n# The exponent of a coefficient you need to multiply base denom to get 1 token on Coingecko.\n# Optional, defaults to 6 (so a coefficient == 1_000_000).\n# 5. ignore\n# Whether the denom should be ignored and not returned in metrics.\n# If specified as true, the exporter would not export this value as metric value in all the places\n# when it does a denom conversion (rewards, commission, self-delegation, voting power etc.)\n# when it does a denom conversion (rewards, commission, self-delegation, voting power etc.)\n# Ignoring a base denom is quite pointless as it would effectively strip most of the useful metrics.\n# Useful for chains where there are tokens of really low value (see Cosmos Hub and their stXXX dust\n# tokens for example).\n# Optional, defaults to false (so, not ignored).\n# Keep in mind that if ignore = false, but coingecko-currency is provided, it will still fetch\n# Coingecko price for this token.\n#\n# You can calculate the actual price of something by multiplying the metric that has denoms by the\n# `cosmos_validators_exporter_price` metric (by chain + denom).\ndenoms = [\n    { denom = "udvpn", display-denom = "dvpn", coingecko-currency = "sentinel", denom-exponent = 6, ignore = false },\n]\n# Bech32 prefix for a wallet address (example: "cosmos" for a Cosmos wallet). If omitted,\n# the self-delegation metric will not be present.\nbech-wallet-prefix = "sent"\n# List of validators to monitor.\n# Address is required, consensus-address is optional but will result in omitting\n# signing-infos metrics (like missed blocks counter).\n# You can get your consensus-address by running "<appd> tendermint show-address" on your validator node,\n# if you are not using KMS solutions.\n# If you are using it to track a consumer chain validator and if you are using the assigned key,\n# please make sure to use the consensus address of this chain and not the provider chain one.\nvalidators = [\n    { address = "<your_senvaloper_address>", consensus-address = "<your_sentvalcons_address>" }\n]\n# Set this to true for ICS provider chains (such as Cosmos Hub).\n# If true, it enabled querying provider\'s consumer chains, which will fail if ICS is not enabled\n# (so for all chains except Cosmos Hub basically).\n# Defaults to false.\nis-provider = false\n\n# List of queries to enable/disable.\n# If the list is not provided, or the value for query is not specified,\n# then this query will be enabled. Useful if some queries on some chains are broken or\n# do not return any meaningful value (like signing info on e-Money) or are too heavy and\n# the node can\'t handle such requests (like delegators count on Cosmos Hub).\n[chains.queries]\n# Query for delegators count. Isn\'t used on consumer chains.\ndelegations = true\n# Query for unbonding delegations count. Isn\'t used on consumer chains.\nunbonds = true\n# Query for self-delegated amount. Isn\'t used on consumer chains.\nself-delegation = true\n# Query for all delegators count/ranking. Also used in total bonded tokens calculation and validator info.\nvalidators = true\n# Query for consumer chain\'s validators. Used in metric representing active validators count on chain.\nconsumer-validators = true\n# Query for consumer chains list and info on provider. Only used on ICS provider chains.\nconsumer-info = true\n# Query for validator unclaimed commission. Isn\'t used on consumer chains.\ncommission = true\n# Query for validator unclaimed self-delegated rewards. Isn\'t used on consumer chains.\nrewards = true\n# Query for validator wallet balance\nbalance = true\n# Query for validator\'s consumer assigned key. Only used for ICS.\n# If disabled, then it\'ll be assumed that the validator is not using assigned keys.\nassigned-key = true\n# Query for validator signing info\nsigning-info = true\n# Query for chain slashing params/missed blocks window\nslashing-params = true\n# Query for consumer\'s soft opt-out threshold. Is only used on consumer chains.\nparams = true\n# Query for chain staking params/max validators count. Isn\'t used on consumer chains.\nstaking-params = true\n# Query for node info (chain_id, app/cosmos-sdk/tendermint version, app name)\nnode-info = true\n'})})})]}),"\n",(0,t.jsx)(o.h3,{id:"add-a-system-unit-file",children:"Add a system unit file"}),"\n",(0,t.jsx)(o.p,{children:"Create the .service file with a text editor"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"sudo nano /etc/systemd/system/cosmos-validators-exporter.service\n"})}),"\n",(0,t.jsx)(o.p,{children:"Paste the below text"}),"\n",(0,t.jsxs)(n,{children:[(0,t.jsx)("summary",{children:"cosmos-validators-exporter.service"}),(0,t.jsx)("p",{children:(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",metastring:'title="/etc/systemd/system/cosmos-validators-exporter.service"',children:"[Unit]\nDescription=Cosmos Validator Exporter\nAfter=network-online.target\n\u200b\n[Service]\nUser=<your_user> #modify this field with your user\nTimeoutStartSec=0\nCPUWeight=95\nIOWeight=95\nExecStart=cosmos-validators-exporter --config /home/<your-user>/cosmos-validators-exporter/config.toml\nRestart=always\nRestartSec=2\nLimitNOFILE=800000\nKillSignal=SIGTERM\n\u200b\n[Install]\nWantedBy=multi-user.target\n"})})})]}),"\n",(0,t.jsx)(o.p,{children:"Reload the systemd Daemon"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,t.jsx)(o.p,{children:"Enable autostart of Cosmos Validator Exporter service"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"sudo systemctl enable cosmos-validators-exporter.service\n"})}),"\n",(0,t.jsx)(o.h3,{id:"start-cosmos-validator-exporter-service",children:"Start Cosmos Validator Exporter service"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"sudo systemctl start cosmos-validators-exporter.service\n"})}),"\n",(0,t.jsx)(o.p,{children:"Use this command to check logs in real time"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"sudo journalctl -u cosmos-validators-exporter.service -f --output cat\n"})}),"\n",(0,t.jsxs)(o.p,{children:["Once the Cosmos Validator Exporter is installed and running, you can verify that ",(0,t.jsx)(o.code,{children:"metrics"})," are being exported by cURLing the /metrics endpoint:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"curl http://localhost:9560/metrics\n"})}),"\n",(0,t.jsx)(o.p,{children:"Success! Cosmos Validator Exporter is now exposing metrics that Prometheus can scrape, including a wide variety of system metrics further down in the output."}),"\n",(0,t.jsx)(o.h3,{id:"open-firewall-port",children:"Open Firewall Port"}),"\n",(0,t.jsxs)(o.admonition,{title:"Important",type:"danger",children:[(0,t.jsx)(o.p,{children:"After successfully installing and launching Cosmos Validator Exporter, the next step is to open port 9560 on your Validator's firewall. This port should be accessible exclusively from your monitoring machine. This action is essential to enable Prometheus to collect data from Cosmos Validator Exporter."}),(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"sudo ufw allow from monitor_ip to validator_ip port 9560\n"})})]}),"\n",(0,t.jsx)(o.h2,{id:"monitoring-machine",children:"Monitoring Machine"}),"\n",(0,t.jsx)(o.p,{children:"On your monitoring machine, go to your prometheus directory and open your prometheus.yml file"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"sudo nano prometheus.yml\n"})}),"\n",(0,t.jsxs)(o.p,{children:["Add the cosmos validator exporter job into it, under ",(0,t.jsx)(o.code,{children:"scrape_configs"})," block"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:' # Cosmos Validator Exporter\n  - job_name: "cosmos-validators-exporter"\n\n    static_configs:\n      - targets: ["<your_validator_ip>:9560"]\n'})})]})}function u(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,o,n)=>{n.d(o,{R:()=>a,x:()=>i});var s=n(96540);const t={},r=s.createContext(t);function a(e){const o=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function i(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:o},e.children)}}}]);