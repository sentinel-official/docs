"use strict";(self.webpackChunksentinel_docs=self.webpackChunksentinel_docs||[]).push([[3370],{72513:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"node-run","title":"Run the Full Node","description":"When setting up a validator and joining a blockchain network, there are three main methods to sync your node: Snapshot, State Sync, and Block Sync. If your node is already running and you\'ve used a Snapshot or State Sync, it\'s important to regularly free up space since the hard drive can fill up over time. Setting up a monitoring system is recommended to alert you when it\'s time to clear out unnecessary data.","source":"@site/docs/full-node-setup/node-run.md","sourceDirName":".","slug":"/node-run","permalink":"/full-node-setup/node-run","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Run the Full Node","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Full Node Setup","permalink":"/full-node-setup/node-setup"},"next":{"title":"Set Public RPC/API","permalink":"/full-node-setup/public-rpc-api/"}}');var o=s(74848),a=s(28453);const i={title:"Run the Full Node",sidebar_position:5},r="Run the Full Node",c={},l=[{value:"Snapshot Sync",id:"snapshot-sync",level:2},{value:"State Sync",id:"state-sync",level:2},{value:"Block Sync",id:"block-sync",level:2},{value:"Check Sync Status",id:"check-sync-status",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"run-the-full-node",children:"Run the Full Node"})}),"\n",(0,o.jsx)(n.p,{children:"When setting up a validator and joining a blockchain network, there are three main methods to sync your node: Snapshot, State Sync, and Block Sync. If your node is already running and you've used a Snapshot or State Sync, it's important to regularly free up space since the hard drive can fill up over time. Setting up a monitoring system is recommended to alert you when it's time to clear out unnecessary data."}),"\n",(0,o.jsx)(n.h2,{id:"snapshot-sync",children:"Snapshot Sync"}),"\n",(0,o.jsx)(n.p,{children:"Downloading a blockchain snapshot allows you to sync your node much faster by using a recent copy of the blockchain. Instead of starting from scratch and processing the entire blockchain, the snapshot brings your node up to a specific point in time. After that, your node only needs to catch up with the new blocks added since the snapshot, significantly speeding up the syncing process."}),"\n",(0,o.jsxs)(n.p,{children:["To bootstrap your node or free up space, you can download and install the latest snapshot using the service provided by ",(0,o.jsx)(n.a,{href:"https://busurnode.com/network/sentinel#service_snapshot",children:"Busurnode"}),". Follow these steps:"]}),"\n",(0,o.jsxs)(n.p,{children:["Create a reusable shell script, like ",(0,o.jsx)(n.code,{children:"snapshot-sync.sh"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"nano snapshot-sync.sh\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Add the code below. If you're using a service name other than ",(0,o.jsx)(n.code,{children:"sentinelhub"}),", like ",(0,o.jsx)(n.code,{children:"cosmovisor"}),", make sure to update the variable ",(0,o.jsx)(n.code,{children:"SERVICE_NAME"})," accordingly."]}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"snapshot-sync.sh"}),(0,o.jsx)("p",{children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\n# Service Name (update this if you use service name other than \'sentinelhub\', such as \'cosmovisor\')\nSERVICE_NAME=sentinelhub\n\n# Install required package\necho "Installing required package"\nsudo apt install -y lz4 jq curl > /dev/null 2>&1\n\n# Get Latest Snapshot URL\nAPI_REQUEST=$(curl -s https://busurnode.com/api/v1/snapshot/mainnet/sentinel)\nIS_SUCCESS=$(echo $API_REQUEST | jq -r \'.success\')\nif [ "$IS_SUCCESS" = "true" ]; then\n  SNAPSHOT_URL=$(echo $API_REQUEST | jq -r \'.data.snapshot.url\')\n  echo "Latest Snapshot URL: $SNAPSHOT_URL"\nelse\n  echo "Error fetching latest snapshot from Busurnode API"\n  exit 1\nfi\n\n# Download the latest snapshot and save it as sentinel_snapshot.tar.lz4\necho "Downloading the latest snapshot..."\ncurl -L --progress-bar -o "$HOME/sentinel_snapshot.tar.lz4" "$SNAPSHOT_URL"\nif [ $? -eq 0 ] && [ -f "$HOME/sentinel_snapshot.tar.lz4" ]; then\n  echo "Download complete: $HOME/sentinel_snapshot.tar.lz4"\nelse\n  echo "Error: Download failed."\n  exit 1\nfi\n\n# Stop the sentinel service\necho "Stopping the sentinel service..."\nsudo service $SERVICE_NAME stop\n\n# Copy the validator state JSON file\ncd $HOME\ncp ~/.sentinelhub/data/priv_validator_state.json ~/.sentinelhub/priv_validator_state.json\n\n# Reset Tendermint state\nsentinelhub tendermint unsafe-reset-all --home $HOME/.sentinelhub --keep-addr-book\n\n# Extract the snapshot\necho "Extracting snapshot..."\nlz4 -c -d $HOME/sentinel_snapshot.tar.lz4 | tar -x -C $HOME/.sentinelhub\nrm $HOME/sentinel_snapshot.tar.lz4\n\n# Replace priv_validator_state from backup\ncp ~/.sentinelhub/priv_validator_state.json ~/.sentinelhub/data/priv_validator_state.json\n\n# Start the sentinel service\necho "Starting the sentinel service..."\nsudo service $SERVICE_NAME start\necho "Process complete."\n'})})})]}),"\n",(0,o.jsx)(n.p,{children:"Next, grant execution permissions to the script:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"chmod 700 snapshot-sync.sh\n"})}),"\n",(0,o.jsx)(n.p,{children:"Run the script:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"./snapshot-sync.sh\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The final step is to check the ",(0,o.jsx)(n.a,{href:"/full-node-setup/node-run#check-sync-status",children:"sync status"})," to confirm when the node has completed synchronization."]}),"\n",(0,o.jsx)(n.p,{children:"If you're looking for other services that provide snapshots, here\u2019s a list of Validators and RPC providers that offer them:"}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"Available Snapshot Providers"}),(0,o.jsx)("p",{children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Autostake: ",(0,o.jsx)(n.a,{href:"https://autostake.com/networks/sentinel/",children:"https://autostake.com/networks/sentinel/"})]}),"\n",(0,o.jsxs)(n.li,{children:["Busurnode: ",(0,o.jsx)(n.a,{href:"https://busurnode.com/network/sentinel#service_snapshot",children:"https://busurnode.com/network/sentinel#service_snapshot"})]}),"\n",(0,o.jsxs)(n.li,{children:["Polkachu: ",(0,o.jsx)(n.a,{href:"https://www.polkachu.com/tendermint_snapshots/sentinel",children:"https://www.polkachu.com/tendermint_snapshots/sentinel"})]}),"\n",(0,o.jsxs)(n.li,{children:["Roomit: ",(0,o.jsx)(n.a,{href:"https://roomit.xyz/snapshot/mainnet/dvpn/",children:"https://roomit.xyz/snapshot/mainnet/dvpn/"})]}),"\n"]})})]}),"\n",(0,o.jsx)(n.h2,{id:"state-sync",children:"State Sync"}),"\n",(0,o.jsx)(n.p,{children:"State Sync is the process of downloading the current state of the blockchain at a recent block height from other peers and then download and process blocks from that height onward. This method reduces the need to process all historical blocks by downloading the entire blockchain, thus speeding up the synchronization process."}),"\n",(0,o.jsx)(n.p,{children:"To bootstrap your node or free up space using State Sync, follow these steps:"}),"\n",(0,o.jsxs)(n.p,{children:["Create a reusable shell script, like ",(0,o.jsx)(n.code,{children:"state-sync.sh"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"nano state-sync.sh\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Add the code below. If you're using a service name other than ",(0,o.jsx)(n.code,{children:"sentinelhub"}),", like ",(0,o.jsx)(n.code,{children:"cosmovisor"}),", make sure to update the variable ",(0,o.jsx)(n.code,{children:"SERVICE_NAME"})," accordingly. To add your preferred RPC, you can check out this list ",(0,o.jsx)(n.a,{href:"https://sentnodes.com/public-rpc",children:"here"}),":"]}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"state-sync.sh"}),(0,o.jsx)("p",{children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\n# Service Name (update this if you use service name other than \'sentinelhub\', such as \'cosmovisor\')\nSERVICE_NAME=sentinelhub\n\nSNAP_RPC1="https://rpc-sentinel.busurnode.com:443"\nSNAP_RPC2="https://eu-rpc-sentinel.busurnode.com:443"\n\n# Fetch block data from RPC\necho "Fetching trusted block data from RPC..."\nLATEST_HEIGHT=$(curl -s $SNAP_RPC1/block | jq -r .result.block.header.height); \\\nBLOCK_HEIGHT=$((LATEST_HEIGHT - 2000)); \\\nTRUST_HASH=$(curl -s "$SNAP_RPC1/block?height=$BLOCK_HEIGHT" | jq -r .result.block_id.hash)\n\necho "Update config with latest block from RPC..."\nsed -i.bak -E "s|^(enable[[:space:]]+=[[:space:]]+).*$|\\1true| ; \\\ns|^(rpc_servers[[:space:]]+=[[:space:]]+).*$|\\1\\"$SNAP_RPC1,$SNAP_RPC2\\"| ; \\\ns|^(trust_height[[:space:]]+=[[:space:]]+).*$|\\1$BLOCK_HEIGHT| ; \\\ns|^(trust_hash[[:space:]]+=[[:space:]]+).*$|\\1\\"$TRUST_HASH\\"|" $HOME/.sentinelhub/config/config.toml\n\n# Stop the sentinel service\necho "Stopping the sentinel service..."\nsudo service $SERVICE_NAME stop\n\n# Copy the validator state JSON file\necho "Backing up validator state..."\ncd $HOME\ncp ~/.sentinelhub/data/priv_validator_state.json ~/.sentinelhub/priv_validator_state.json\n\n# Reset Tendermint state\nsentinelhub tendermint unsafe-reset-all --home $HOME/.sentinelhub --keep-addr-book\n\n# Replace priv_validator_state from backup\necho "Recover validator state from backup..."\ncp ~/.sentinelhub/priv_validator_state.json ~/.sentinelhub/data/priv_validator_state.json\n\n# Start the sentinel service\necho "Starting the sentinel service..."\nsudo service $SERVICE_NAME start\necho "Process complete."\n'})})})]}),"\n",(0,o.jsx)(n.p,{children:"This script ensures that the new synchronization process starts from a point slightly before the absolute latest block. This provides a margin of safety and avoid potential synchronization issues that might occur due to due network delays or other factors."}),"\n",(0,o.jsx)(n.p,{children:"Next, grant execution permissions to the script:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"chmod 700 state-sync.sh\n"})}),"\n",(0,o.jsx)(n.p,{children:"Run the script:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"./state-sync.sh\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The final step is to check the ",(0,o.jsx)(n.a,{href:"/full-node-setup/node-run#check-sync-status",children:"sync status"})," to confirm when the node has completed synchronization."]}),"\n",(0,o.jsx)(n.h2,{id:"block-sync",children:"Block Sync"}),"\n",(0,o.jsxs)(n.p,{children:["Block Sync involves starting from the genesis block of the blockchain and then sequentially downloading and validating every block until the node is fully synchronized with the current state of the blockchain. This process can be time-consuming because it requires processing every transaction in the blockchain's history.\nBlock sync is typically used when someone wants to host ",(0,o.jsx)(n.code,{children:"archive nodes"}),", which are nodes that retain the full history of the blockchain, including all the blocks and their associated states from the genesis block to the current block. This means they have the entire blockchain's data and can provide historical data queries for any point in the blockchain's history. Detailed guidance on setting up and maintaining an archive node will be covered in the future."]}),"\n",(0,o.jsx)(n.h2,{id:"check-sync-status",children:"Check Sync Status"}),"\n",(0,o.jsx)(n.p,{children:"After starting your node, it will fully synchronize within a few minutes. Periodically check its status using the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'curl --silent "http://localhost:26657/status" | jq -S\n'})}),"\n",(0,o.jsxs)(n.p,{children:["If the value of ",(0,o.jsx)(n.code,{children:"result.sync_info.catching_up"})," is ",(0,o.jsx)(n.code,{children:"false"}),", it indicates that the node is synchronized and ready to start signing blocks."]}),"\n",(0,o.jsx)(n.p,{children:"To monitor the logs in real-time, use the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo journalctl -u sentinelhub.service -f --output=cat\n"})})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>r});var t=s(96540);const o={},a=t.createContext(o);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);