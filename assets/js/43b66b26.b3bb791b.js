"use strict";(self.webpackChunksentinel_docs=self.webpackChunksentinel_docs||[]).push([[9744],{65453:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"validate/essential-tools/restake/setup-config","title":"Setup & Configuration","description":"A step-by-step procedure to prepare you REStake service","source":"@site/docs/full-node-setup/validate/essential-tools/restake/setup-config.md","sourceDirName":"validate/essential-tools/restake","slug":"/validate/essential-tools/restake/setup-config","permalink":"/full-node-setup/validate/essential-tools/restake/setup-config","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Setup & Configuration","description":"A step-by-step procedure to prepare you REStake service","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/full-node-setup/validate/essential-tools/restake/overview"},"next":{"title":"Submit Operator","permalink":"/full-node-setup/validate/essential-tools/restake/submit-operator"}}');var r=s(74848),i=s(28453);const a={title:"Setup & Configuration",description:"A step-by-step procedure to prepare you REStake service",sidebar_position:2},l="Setup & Configuration",o={},c=[{value:"Install Docker",id:"install-docker",level:2},{value:"Create a mnemonic",id:"create-a-mnemonic",level:2},{value:"Clone and configure Restake",id:"clone-and-configure-restake",level:2},{value:"Running the script",id:"running-the-script",level:2},{value:"Setting up a timer to run the script on a schedule",id:"setting-up-a-timer-to-run-the-script-on-a-schedule",level:2},{value:"Create a systemd unit file",id:"create-a-systemd-unit-file",level:3},{value:"Create a systemd timer file",id:"create-a-systemd-timer-file",level:3},{value:"Enable and start the 2 created services",id:"enable-and-start-the-2-created-services",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"setup--configuration",children:"Setup & Configuration"})}),"\n",(0,r.jsx)(n.h2,{id:"install-docker",children:"Install Docker"}),"\n",(0,r.jsxs)(n.p,{children:["Install Docker Engine from official ",(0,r.jsx)(n.a,{href:"https://docs.docker.com/engine/",children:"site"})]}),"\n",(0,r.jsx)(n.h2,{id:"create-a-mnemonic",children:"Create a mnemonic"}),"\n",(0,r.jsx)(n.p,{children:"This mnemonic will be used only for Restake.app."}),"\n",(0,r.jsx)(n.p,{children:"First, download and install the Sentinel dVPN CLI:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"wget https://github.com/sentinel-official/sentinel-dvpncli/releases/tag/v0.3.2/sentinelcli_linux_x86_64.tar.gz\ntar xvzf sentinelcli_linux_x86_64.tar.gz\nsudo mv ${HOME}/sentinelcli /usr/local/bin\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now, create a new key and mnemonic by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sentinelcli keys add keyname\n"})}),"\n",(0,r.jsx)(n.p,{children:"You\u2019ll be asked to set a passphrase.\nMake sure to write down and safely store both:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The mnemonic phrase"}),"\n",(0,r.jsx)(n.li,{children:"The operator address"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Finally, don\u2019t forget to ",(0,r.jsx)(n.strong,{children:"add funds"})," to the operator address before using it."]}),"\n",(0,r.jsx)(n.h2,{id:"clone-and-configure-restake",children:"Clone and configure Restake"}),"\n",(0,r.jsx)(n.p,{children:"Clone the repository and copy the sample .env file ready for your mnemonic"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/eco-stake/restake.git\n"})}),"\n",(0,r.jsx)(n.p,{children:"Go into Restake directory"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd restake\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Rename the file  ",(0,r.jsx)(n.code,{children:".env.sample"})," to ",(0,r.jsx)(n.code,{children:".env"}),", then open it"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mv .env.sample .env\nnano .env\n"})}),"\n",(0,r.jsx)(n.p,{children:"Add your mnemonic:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"MNEMONIC=my hot wallet seed words here that has minimal funds\n"})}),"\n",(0,r.jsx)(n.p,{children:"Pre-build your Docker containers with the following commands:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker compose run --rm app npm install\ndocker compose build --no-cache\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Navigate to the ",(0,r.jsx)(n.code,{children:"src"})," directory"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd src/\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Rename the file ",(0,r.jsx)(n.code,{children:".networks.local.json"})," to ",(0,r.jsx)(n.code,{children:".networks.local.json.sample"}),", then open it:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mv networks.local.json.sample networks.local.json\nnano networks.local.json\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Replace the file with the following code block. For the ",(0,r.jsx)(n.code,{children:"restUrl"})," field, choose your preferred RPC endpoint from ",(0,r.jsx)(n.a,{href:"https://sentnodes.com/public-rpc",children:"this list"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=".networks.local.json"',children:'{\n  "sentinel": {\n    "prettyName": "Sentinel 881",\n    "restUrl": [\n      "https://api.sentineldao.com:443" \n    ],\n    "autostake": {\n      "correctSlip44": false,\n      "delegationsTimeout": 300000,\n      "queryTimeout": 300000\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"running-the-script",children:"Running the script"}),"\n",(0,r.jsx)(n.p,{children:"Run this command adding as last word sentinel which is the network we are going to enable"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo docker compose run --rm app npm run autostake sentinel\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should see something like that:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"> restake@0.1.0 autostake\n> node scripts/autostake.mjs sentinel\n\n[09:30:19.711] \u269b\n[09:30:20.268] Loaded Sentinel 881\n[09:30:20.458] Bot address is sent1eyhgvkqu48luluafpfn4myg5jr04g6zje9zkkf\n[09:30:20.459] Not an operator\n[09:30:20.460] Autostake finished\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The message ",(0,r.jsx)(n.code,{children:'"Not an Operator"'})," is fine as we have to submit our operator to Chain Registry"]}),"\n",(0,r.jsx)(n.h2,{id:"setting-up-a-timer-to-run-the-script-on-a-schedule",children:"Setting up a timer to run the script on a schedule"}),"\n",(0,r.jsx)(n.p,{children:"You should setup your script to run at the same time each day. We will use the methos based on systemd-timer which allows to run a one-off service with specified rules. This method is arguably preferable to crontab, which we will not cover."}),"\n",(0,r.jsx)(n.h3,{id:"create-a-systemd-unit-file",children:"Create a systemd unit file"}),"\n",(0,r.jsxs)(n.p,{children:["The unit file describes the application to run. We define a dependency with the timer with the Wants statement.\nCreate the ",(0,r.jsx)(n.code,{children:"restake.service"})," file"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/systemd/system/restake.service\n"})}),"\n",(0,r.jsx)(n.p,{children:"Add the following code block"}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"restake.service"}),(0,r.jsx)("p",{children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/systemd/system/restake.service"',children:"[Unit]\nDescription=restake service with docker compose\nRequires=docker.service\nAfter=docker.service\nWants=restake.timer\n\n[Service]\nType=oneshot\nWorkingDirectory=/home/trinity/restake\nExecStart=/usr/bin/docker compose run --rm app npm run autostake sentinel\n\n[Install]\nWantedBy=multi-user.target\n"})})})]}),"\n",(0,r.jsx)(n.h3,{id:"create-a-systemd-timer-file",children:"Create a systemd timer file"}),"\n",(0,r.jsxs)(n.p,{children:["The timer file defines the rules for running the restake service every hour. All rules are described in the ",(0,r.jsx)(n.a,{href:"https://www.freedesktop.org/software/systemd/man/systemd.timer.html",children:"systemd documentation"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Create the ",(0,r.jsx)(n.code,{children:"restake.timer"})," file"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/systemd/system/restake.timer\n"})}),"\n",(0,r.jsx)(n.p,{children:"Add the following code block"}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"restake.timer"}),(0,r.jsx)("p",{children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/systemd/system/restake.timer"',children:"[Unit]\nDescription=Restake bot timer\n\n[Timer]\nAccuracySec=1min\nOnCalendar=*-*-* *:00:00\n\n[Install]\nWantedBy=timers.target\n"})})})]}),"\n",(0,r.jsx)(n.h3,{id:"enable-and-start-the-2-created-services",children:"Enable and start the 2 created services"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable restake.service\nsudo systemctl enable restake.timer\nsudo systemctl start restake.timer\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check the restake.timer status"})}),"\n",(0,r.jsxs)(n.p,{children:["With ",(0,r.jsx)(n.code,{children:"systemctl"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status restake.timer\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Or with ",(0,r.jsx)(n.code,{children:"journalctl"})," in real time:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo journalctl -u restake.service -f --output=cat\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should see something like that:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"\u25cf restake.timer - Restake bot timer\n     Loaded: loaded (/etc/systemd/system/restake.timer; enabled; vendor preset: enabled)\n     Active: active (waiting) since Thu 2023-07-13 12:24:40 UTC; 4min 19s ago\n    Trigger: Thu 2023-07-13 13:00:00 UTC; 30min left\n   Triggers: \u25cf restake.service\n\nJul 13 12:24:40 trinity-management systemd[1]: Started Restake bot timer.\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check the restake.service status"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status restake.service\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should see something like that:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"\u25cf restake.service - restake service with docker compose\n     Loaded: loaded (/etc/systemd/system/restake.service; enabled; vendor preset: enabled)\n     Active: inactive (dead)\nTriggeredBy: \u25cf restake.timer\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now you are ready to submit your operator to Restake.app"})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var t=s(96540);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);